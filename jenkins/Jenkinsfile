pipeline {
    agent any

    stages {
        stage('Verify Environment') {
            steps {
                echo 'üîç Checking environment variables...'
                bat '"C:\\Windows\\System32\\cmd.exe" /c echo PATH=%PATH%'
                bat '"C:\\Windows\\System32\\cmd.exe" /c where node'
                bat '"C:\\Windows\\System32\\cmd.exe" /c where npm'
            }
        }

        stage('Build') {
            steps {
                echo 'üîß Installing dependencies...'
                bat '"C:\\Windows\\System32\\cmd.exe" /c "C:\\Program Files\\nodejs\\node.exe" -v'
                bat '"C:\\Windows\\System32\\cmd.exe" /c "C:\\Program Files\\nodejs\\npm.cmd" -v'
                bat '"C:\\Windows\\System32\\cmd.exe" /c "C:\\Program Files\\nodejs\\npm.cmd" install"'
            }
        }

        stage('Test') {
            steps {
                echo 'üß™ Running tests...'
                bat '"C:\\Windows\\System32\\cmd.exe" /c "C:\\Program Files\\nodejs\\npm.cmd" test || echo No test script found"'
            }
        }
    }

    post {
        success {
            echo '‚úÖ Build and Test completed successfully!'
        }
        failure {
            echo '‚ùå Build or Test failed ‚Äî check console output.'
        }
    }
}
